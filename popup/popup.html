<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Prompt Manager</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div id="notification-container"></div>

  <header class="app-header">
    <h1 class="app-title">AI Prompt Manager</h1>
    <div class="header-actions">
      <button id="btn-shortcuts" class="icon-btn" title="Keyboard Shortcuts">⌨️</button>
      <button id="btn-settings" class="icon-btn" title="Settings">⚙️</button>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-view="canvas">Canvas</button>
    <button class="tab" data-view="prompts">Prompts</button>
    <button class="tab" data-view="templates">Templates</button>
    <button class="tab" data-view="packs">Variable Packs</button>
    <button class="tab" data-view="drafts">Drafts</button>
    <button class="tab" data-view="categories">Categories</button>
    <button class="tab" data-view="tags">Tags</button>
  </nav>

  <main class="content">
    
    <!-- CANVAS VIEW -->
    <section id="view-canvas" class="view active">
      <div class="sticky-header">
        <button id="btn-new-draft" class="btn-secondary">🆕 New</button>
        <button id="btn-load-draft" class="btn-secondary">📂 Load</button>
        <button id="btn-save-draft" class="btn-secondary" disabled>💾 Save</button>
        <button id="btn-canvas-settings" class="btn-secondary">⚙️ Options</button>
        <button id="btn-copy-canvas" class="btn-primary btn-clipboard">📋 Copy to Clipboard</button>
        <button id="btn-copy-canvas-minify" class="btn-secondary">📦 Minify</button>
      </div>

      <div class="canvas-layout">
        <aside class="canvas-sidebar">
          <div class="sidebar-header">
            <h3>Parts</h3>
            <button id="btn-add-part" class="icon-btn">➕</button>
          </div>
          <div id="canvas-parts-list" class="canvas-parts-list">
            <div class="empty-state-small">
              <p>No parts yet</p>
              <button class="btn-secondary-sm" id="btn-add-first-part">Add Prompt</button>
            </div>
          </div>
          
          <div class="sidebar-header" style="margin-top: 20px;">
            <h3>Variables <span id="var-count-badge" class="count-badge">0</span></h3>
            <button id="btn-clear-vars" class="icon-btn" title="Clear all" style="display:none;">🗑️</button>
          </div>
          <div id="variables-list" class="variables-list"></div>
        </aside>

        <div class="canvas-editor-container">
          <div class="canvas-stats">
            <span id="canvas-char-count">0 characters</span>
            <span id="canvas-word-count">0 words</span>
            <span id="canvas-part-count">0 parts</span>
            <span id="canvas-token-estimate">~0 tokens</span>
          </div>
          
          <div class="canvas-quick-actions">
            <button id="btn-save-quick-set" class="btn-secondary-sm">💾 Save as Quick Set</button>
            <button id="btn-load-quick-set" class="btn-secondary-sm">📂 Load Quick Set</button>
            <button id="btn-apply-var-pack" class="btn-secondary-sm">📦 Apply Variable Pack</button>
          </div>
          
          <textarea id="canvas-editor" class="canvas-editor" placeholder="Compose your megaprompt here...

• Add prompts from library
• Use variables: {{variableName}}
• Smart variables: {{date}}, {{time}}, {{user.name}}
• Drag & drop to reorder
• Copy to clipboard"></textarea>
          
          <div class="canvas-warnings" id="canvas-warnings" style="display:none;"></div>
        </div>
      </div>
    </section>

    <!-- PROMPTS VIEW -->
    <section id="view-prompts" class="view">
      <div class="sticky-header">
        <div class="search-box">
          <input type="text" id="search-prompts" placeholder="Search prompts..." aria-label="Search">
        </div>
        <select id="filter-category">
          <option value="">All Categories</option>
        </select>
        <label class="auto-filter-toggle">
          <input type="checkbox" id="auto-filter-toggle">
          <span>Auto-Filter</span>
        </label>
        <div id="profile-chips" class="profile-chips"></div>
        <button id="btn-add-prompt" class="btn-primary">+ New Prompt</button>
      </div>
      <div id="prompt-list" class="item-list"></div>
      <div id="empty-prompts" class="empty-state" style="display:none;">
        <p>No prompts yet</p>
        <button id="btn-empty-create-prompt" class="btn-secondary">Create First Prompt</button>
      </div>
    </section>

    <!-- TEMPLATES VIEW -->
    <section id="view-templates" class="view">
      <div class="sticky-header">
        <h2>Framework Templates</h2>
        <button id="btn-add-custom-template" class="btn-primary">+ Custom Template</button>
      </div>
      <div class="templates-grid">
        <div class="template-card" data-framework="CRISE">
          <div class="template-header">
            <h3>CRISE Framework</h3>
            <span class="template-badge">Built-in</span>
          </div>
          <p class="template-description">Context, Role, Instruction, Samples, Evaluation</p>
          <div class="template-actions">
            <button class="btn-secondary btn-use-template" data-framework="CRISE">Use Template</button>
          </div>
        </div>
        <div class="template-card" data-framework="CRAFT">
          <div class="template-header">
            <h3>CRAFT Framework</h3>
            <span class="template-badge">Built-in</span>
          </div>
          <p class="template-description">Cut, Reframe, Add detail, Format, Test</p>
          <div class="template-actions">
            <button class="btn-secondary btn-use-template" data-framework="CRAFT">Use Template</button>
          </div>
        </div>
        <div class="template-card" data-framework="TAG">
          <div class="template-header">
            <h3>TAG Framework</h3>
            <span class="template-badge">Built-in</span>
          </div>
          <p class="template-description">Task, Audience, Goal</p>
          <div class="template-actions">
            <button class="btn-secondary btn-use-template" data-framework="TAG">Use Template</button>
          </div>
        </div>
      </div>
      <div id="custom-templates-list" class="item-list"></div>
    </section>

    <!-- VARIABLE PACKS VIEW -->
    <section id="view-packs" class="view">
      <div class="sticky-header">
        <div class="search-box">
          <input type="text" id="search-packs" placeholder="Search packs..." aria-label="Search">
        </div>
        <button id="btn-create-pack-from-current" class="btn-secondary">💾 From Current Variables</button>
        <button id="btn-add-pack" class="btn-primary">+ New Pack</button>
      </div>
      <div id="pack-list" class="item-list"></div>
      <div id="empty-packs" class="empty-state" style="display:none;">
        <p>No variable packs yet</p>
        <button id="btn-empty-create-pack" class="btn-secondary">Create First Pack</button>
      </div>
    </section>

    <!-- DRAFTS VIEW -->
    <section id="view-drafts" class="view">
      <div class="sticky-header">
        <h2>Saved Drafts</h2>
        <button id="btn-create-draft" class="btn-primary">+ New Draft</button>
      </div>
      <div id="drafts-list" class="item-list"></div>
      <div id="empty-drafts" class="empty-state" style="display:none;">
        <p>No drafts saved yet</p>
      </div>
    </section>

    <!-- CATEGORIES VIEW -->
    <section id="view-categories" class="view">
      <div class="sticky-header">
        <button id="btn-add-category" class="btn-primary">+ New Category</button>
      </div>
      <div id="category-list" class="item-list"></div>
      <div id="empty-categories" class="empty-state" style="display:none;">
        <p>No categories yet</p>
      </div>
    </section>

    <!-- TAGS VIEW -->
    <section id="view-tags" class="view">
      <div class="sticky-header">
        <button id="btn-add-tag" class="btn-primary">+ New Tag</button>
        <button id="btn-add-profile" class="btn-secondary">+ New Profile</button>
      </div>
      <div class="subtabs">
        <button class="subtab active" data-subtab="tags">Tags</button>
        <button class="subtab" data-subtab="profiles">Profiles</button>
      </div>
      <div id="tag-list" class="item-list"></div>
      <div id="profile-list" class="item-list" style="display:none;"></div>
      <div id="empty-tags" class="empty-state" style="display:none;">
        <p>No tags yet</p>
      </div>
      <div id="empty-profiles" class="empty-state" style="display:none;">
        <p>No profiles yet</p>
      </div>
    </section>

  </main>

  <!-- MODALS -->
  
  <div id="modal-prompt" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-prompt-title">Prompt</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-prompt">
          <div class="form-group">
            <label for="prompt-title">Title *</label>
            <input type="text" id="prompt-title" required>
          </div>
          <div class="form-group">
            <label for="prompt-description">Description</label>
            <input type="text" id="prompt-description">
          </div>
          <div class="form-group">
            <label for="prompt-content">Content *</label>
            <textarea id="prompt-content" rows="12" required></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="prompt-category">Category</label>
              <select id="prompt-category">
                <option value="">No Category</option>
              </select>
            </div>
            <div class="form-group">
              <label>Tags</label>
              <div id="prompt-tags" class="tag-selector"></div>
            </div>
          </div>
          <div class="form-group">
            <label>Profiles</label>
            <div id="prompt-profiles" class="tag-selector"></div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-ghost modal-close">Cancel</button>
            <button type="submit" class="btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="modal-category" class="modal">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 id="modal-category-title">Category</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-category">
          <div class="form-group">
            <label for="category-name">Name *</label>
            <input type="text" id="category-name" required>
          </div>
          <div class="form-group">
            <label for="category-color">Color</label>
            <input type="color" id="category-color" value="#3B82F6">
          </div>
          <div class="form-actions">
            <button type="button" class="btn-ghost modal-close">Cancel</button>
            <button type="submit" class="btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="modal-tag" class="modal">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 id="modal-tag-title">Tag</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-tag">
          <div class="form-group">
            <label for="tag-name">Name *</label>
            <input type="text" id="tag-name" required>
          </div>
          <div class="form-group">
            <label for="tag-color">Color</label>
            <input type="color" id="tag-color" value="#8B5CF6">
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="tag-is-profile">
              Mark as Profile
            </label>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-ghost modal-close">Cancel</button>
            <button type="submit" class="btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="modal-variable-pack" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-pack-title">Variable Pack</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="form-pack">
          <div class="form-group">
            <label for="pack-name">Name *</label>
            <input type="text" id="pack-name" required>
          </div>
          <div class="form-group">
            <label for="pack-description">Description</label>
            <textarea id="pack-description" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label>Variables</label>
            <div id="pack-variables" class="pack-variables">
              <button type="button" id="btn-add-pack-var" class="btn-secondary-sm">+ Add Variable</button>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-ghost modal-close">Cancel</button>
            <button type="submit" class="btn-primary">Save Pack</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="modal-settings" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3>Display</h3>
          <button id="btn-toggle-density" class="btn-secondary">📏 Toggle Density</button>
          <button id="btn-toggle-wide" class="btn-secondary">↔️ Toggle Wide Mode</button>
        </div>
        <div class="settings-section">
          <h3>Data</h3>
          <button id="btn-export" class="btn-secondary">📤 Export All</button>
          <button id="btn-import" class="btn-secondary">📥 Import</button>
          <input type="file" id="file-import" accept=".json" style="display:none;">
        </div>
        <div class="settings-section">
          <h3>Danger Zone</h3>
          <button id="btn-delete-all" class="btn-danger">🗑️ Delete All Data</button>
        </div>
      </div>
    </div>
  </div>

  <script src="../core/dataModel.js"></script>
  <script src="../core/storage.js"></script>
  <script src="../core/megaprompt.js"></script>
  <script src="../core/variableEngine.js"></script>
  <script src="../core/variablePackManager.js"></script>
  <script src="../core/templateManager.js"></script>
  <script src="../core/megadraftManager.js"></script>
  <script src="../core/commandPalette.js"></script>
  <script src="popup.js"></script>
</body>
</html>